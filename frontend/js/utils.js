export const productsList = [
    { _id: 1, imgPath: "./assets/Products/p1.png", name: "T-Shirt with Tape Details", description: "A stylish t-shirt with tape details for a casual look.", rating: 4.5, price: "$125", discount: 0.0, availableSizes: ["small", "medium", "large"], categories: ["casual"], arrivalDate: "2025-01-01", stock: 100 },
    { _id: 2, imgPath: "./assets/Products/p2.png", name: "Skinny Fit Jeans", description: "Comfortable skinny fit jeans for everyday wear.", rating: 5, price: "$240", discount: 0.0, availableSizes: ["medium", "large", "xlarge"], categories: ["casual"], arrivalDate: "2025-02-01", stock: 50 },
    { _id: 3, imgPath: "./assets/Products/p3.png", name: "Checkered Shirt", description: "A classic checkered shirt perfect for parties.", rating: 3, price: "$180", discount: 0.20, availableSizes: ["small", "medium", "large", "xlarge"], categories: ["party"], arrivalDate: "2025-03-01", stock: 75 },
    { _id: 4, imgPath: "./assets/Products/p4.png", name: "Sleeve Striped T-Shirt", description: "A casual t-shirt with striped sleeves for a trendy look.", rating: 2.5, price: "$130", discount: 0.0, availableSizes: ["xsmall", "small", "medium"], categories: ["casual"], arrivalDate: "2025-04-01", stock: 120 },
    { _id: 5, imgPath: "./assets/Products/p5.png", name: "Gradient Graphic T-shirt", description: "A graphic t-shirt with a gradient design for casual and party wear.", rating: 4.6, price: "$160", discount: 0.3, availableSizes: ["medium", "large", "xlarge", "xxlarge"], categories: ["casual", "party"], arrivalDate: "2024-04-01", stock: 80 },
    { _id: 6, imgPath: "./assets/Products/p6.png", name: "Virtical Stripped Shirt", description: "A vertical striped shirt suitable for casual and party occasions.", rating: 4.1, price: "$285", discount: 0.3, availableSizes: ["small", "medium", "large"], categories: ["casual", "party"], arrivalDate: "2024-02-01", stock: 60 },
    { _id: 7, imgPath: "./assets/Products/p7.png", name: "Faded Skinny Jeans", description: "Skinny jeans with a faded design for a casual look.", rating: 3.5, price: "$240", discount: 0.1, availableSizes: ["xxsmall", "xsmall", "small"], categories: ["casual"], arrivalDate: "2022-07-01", stock: 30 },
    { _id: 8, imgPath: "./assets/Products/p8.png", name: "Slim Fit Chinos", description: "Slim fit chinos for a comfortable and stylish appearance.", rating: 4.2, price: "$110", discount: 0.0, availableSizes: ["medium", "large", "xlarge", "xxlarge"], categories: ["casual"], arrivalDate: "2022-08-01", stock: 90 },
    { _id: 9, imgPath: "./assets/Products/p9.png", name: "Crewneck Sweatshirt", description: "A cozy crewneck sweatshirt for casual wear.", rating: 4.6, price: "$85", discount: 0.0, availableSizes: ["small", "medium", "large", "xlarge", "xxxlarge"], categories: ["casual"], arrivalDate: "2022-09-01", stock: 110 },
    { _id: 10, imgPath: "./assets/Products/p10.png", name: "Graphic Print Tee", description: "A graphic print tee for a casual and trendy look.", rating: 4.1, price: "$60", discount: 0.0, availableSizes: ["xsmall", "small", "medium", "large"], categories: ["casual"], arrivalDate: "2022-10-01", stock: 70 },
    { _id: 11, imgPath: "./assets/Products/p11.png", name: "Puffer Jacket", description: "A warm puffer jacket for cold weather.", rating: 4.9, price: "$210", discount: 0.0, availableSizes: ["medium", "large", "xlarge", "xxlarge", "xxxlarge"], categories: ["casual"], arrivalDate: "2022-11-01", stock: 30 },
    { _id: 12, imgPath: "./assets/Products/p12.png", name: "Linen Shorts", description: "Comfortable linen shorts for gym and casual wear.", rating: 3.9, price: "$55", discount: 0.0, availableSizes: ["xsmall", "small", "medium"], categories: ["gym"], arrivalDate: "2022-12-01", stock: 0 },

    { _id: 13, imgPath: "./assets/Products/p13.png", name: "Varsity Jacket", description: "A stylish varsity jacket for casual and formal occasions.", rating: 5, price: "$275", discount: 0.0, availableSizes: ["medium", "large", "xlarge", "xxlarge"], categories: ["casual", "formal"], arrivalDate: "2023-01-01", stock: 45 },
    { _id: 14, imgPath: "./assets/Products/p14.png", name: "Cargo Pants", description: "Durable cargo pants for a casual look.", rating: 4.4, price: "$95", discount: 0.0, availableSizes: ["small", "medium", "large", "xlarge"], categories: ["casual"], arrivalDate: "2023-02-01", stock: 85 },
    { _id: 15, imgPath: "./assets/Products/p15.png", name: "V-Neck Sweater", description: "A comfortable v-neck sweater for casual wear.", rating: 3.8, price: "$80", discount: 0.0, availableSizes: ["xsmall", "small", "medium", "large"], categories: ["casual"], arrivalDate: "2023-03-01", stock: 17 },
    { _id: 16, imgPath: "./assets/Products/p16.png", name: "Oversized Tee", description: "An oversized tee for a relaxed and casual look.", rating: 4.3, price: "$65", discount: 0.0, availableSizes: ["medium", "large", "xlarge"], categories: ["casual"], arrivalDate: "2023-04-01", stock: 95 },
    { _id: 17, imgPath: "./assets/Products/p17.png", name: "Fleece Joggers", description: "Comfortable fleece joggers for casual wear.", rating: 4.7, price: "$100", discount: 0.0, availableSizes: ["small", "medium", "large", "xxlarge"], categories: ["casual"], arrivalDate: "2023-05-01", stock: 75 },
    { _id: 18, imgPath: "./assets/Products/p18.png", name: "Ripped Jeans", description: "Stylish ripped jeans for a casual look.", rating: 4.5, price: "$130", discount: 0.0, availableSizes: ["medium", "large", "xlarge", "xxlarge"], categories: ["casual"], arrivalDate: "2023-06-01", stock: 60 },
    { _id: 19, imgPath: "./assets/Products/p19.png", name: "Turtleneck Sweater", description: "A cozy turtleneck sweater for casual wear.", rating: 4.6, price: "$120", discount: 0.0, availableSizes: ["small", "medium", "large", "xlarge"], categories: ["casual"], arrivalDate: "2023-07-01", stock: 80 },
    { _id: 20, imgPath: "./assets/Products/p20.png", name: "Polo Shirt", description: "A classic polo shirt for casual occasions.", rating: 3.7, price: "$75", discount: 0.0, availableSizes: ["xsmall", "small", "medium", "large"], categories: ["casual"], arrivalDate: "2023-08-01", stock: 0 },
    { _id: 21, imgPath: "./assets/Products/p21.png", name: "Knitted Cardigan", description: "A warm knitted cardigan for casual wear.", rating: 4.8, price: "$145", discount: 0.0, availableSizes: ["medium", "large", "xlarge", "xxlarge"], categories: ["casual"], arrivalDate: "2023-09-01", stock: 55 },
    { _id: 22, imgPath: "./assets/Products/p22.png", name: "Tracksuit Set", description: "A comfortable tracksuit set for casual wear.", rating: 4.2, price: "$170", discount: 0.0, availableSizes: ["small", "medium", "large", "xlarge", "xxxlarge"], categories: ["casual"], arrivalDate: "2023-10-01", stock: 40 },
    { _id: 23, imgPath: "./assets/Products/p23.png", name: "Tank Top", description: "A lightweight tank top for casual wear.", rating: 3.6, price: "$30", discount: 0.0, availableSizes: ["xxsmall", "xsmall", "small"], categories: ["casual"], arrivalDate: "2023-11-01", stock: 100 },
    { _id: 24, imgPath: "./assets/Products/p24.png", name: "Bomber Jacket", description: "A stylish bomber jacket for casual wear.", rating: 4.9, price: "$190", discount: 0.0, availableSizes: ["medium", "large", "xlarge", "xxlarge", "xxxlarge"], categories: ["casual"], arrivalDate: "2023-12-01", stock: 20 },

    { _id: 25, imgPath: "./assets/Products/p25.png", name: "Athletic Shorts", description: "Comfortable athletic shorts for gym and casual wear.", rating: 4.1, price: "$50", discount: 0.0, availableSizes: ["xsmall", "small", "medium", "large"], categories: ["gym"], arrivalDate: "2024-01-01", stock: 19 },
    { _id: 26, imgPath: "./assets/Products/p26.png", name: "Checked Blazer", description: "A stylish checked blazer for formal occasions.", rating: 4.7, price: "$200", discount: 0.0, availableSizes: ["medium", "large", "xlarge", "xxlarge"], categories: ["formal"], arrivalDate: "2023-01-01", stock: 30 },
    { _id: 27, imgPath: "./assets/Products/p27.png", name: "Sleeveless Hoodie", description: "A sleeveless hoodie for a casual and sporty look.", rating: 3.5, price: "$70", discount: 0.0, availableSizes: ["small", "medium", "large"], categories: ["casual"], arrivalDate: "2023-02-01", stock: 50 },
    { _id: 28, imgPath: "./assets/Products/p28.png", name: "Flannel Shirt", description: "A classic flannel shirt for party occasions.", rating: 4.4, price: "$95", discount: 0.0, availableSizes: ["small", "medium", "large", "xlarge"], categories: ["party"], arrivalDate: "2023-03-01", stock: 65 },
    { _id: 29, imgPath: "./assets/Products/p29.png", name: "Basic Tee Pack", description: "A pack of basic tees for casual wear.", rating: 4.3, price: "$85", discount: 0.0, availableSizes: ["xsmall", "small", "medium", "large"], categories: ["casual"], arrivalDate: "2023-04-01", stock: 90 },
    { _id: 30, imgPath: "./assets/Products/p30.png", name: "Longline Shirt", description: "A longline shirt for a casual and trendy look.", rating: 4.0, price: "$75", discount: 0.0, availableSizes: ["medium", "large", "xlarge"], categories: ["casual"], arrivalDate: "2023-05-01", stock: 0 },
    { _id: 31, imgPath: "./assets/Products/p31.png", name: "Distressed Jeans", description: "Stylish distressed jeans for casual wear.", rating: 4.2, price: "$140", discount: 0.0, availableSizes: ["medium", "large", "xlarge", "xxlarge"], categories: ["casual"], arrivalDate: "2023-06-01", stock: 70 },
    { _id: 32, imgPath: "./assets/Products/p32.png", name: "Wool Overcoat", description: "A warm wool overcoat for formal occasions.", rating: 4.8, price: "$300", discount: 0.0, availableSizes: ["large", "xlarge", "xxlarge", "xxxlarge"], categories: ["formal"], arrivalDate: "2023-07-01", stock: 25 },
    { _id: 33, imgPath: "./assets/Products/p33.png", name: "Colorblock Hoodie", description: "A trendy colorblock hoodie for casual and party wear.", rating: 4.6, price: "$95", discount: 0.0, availableSizes: ["small", "medium", "large", "xlarge"], categories: ["casual", "party"], arrivalDate: "2023-08-01", stock: 45 },
    { _id: 34, imgPath: "./assets/Products/p34.png", name: "Utility Vest", description: "A functional utility vest for casual wear.", rating: 3.9, price: "$100", discount: 0.0, availableSizes: ["xsmall", "small", "medium"], categories: ["casual"], arrivalDate: "2023-09-01", stock: 0 },
    { _id: 35, imgPath: "./assets/Products/p35.png", name: "Sleeve Logo Tee", description: "A sleeve logo tee for gym and casual wear.", rating: 4.1, price: "$60", discount: 0.0, availableSizes: ["xsmall", "small", "medium", "large"], categories: ["casual", "gym"], arrivalDate: "2023-10-01", stock: 65 },
    { _id: 36, imgPath: "./assets/Products/p36.png", name: "Cropped Cargo Pants", description: "Stylish cropped cargo pants for casual wear.", rating: 4.5, price: "$115", discount: 0.0, availableSizes: ["medium", "large", "xlarge", "xxlarge"], categories: ["casual"], arrivalDate: "2023-11-01", stock: 0 },

    { _id: 37, imgPath: "./assets/Products/p37.png", name: "Button-Up Denim Shirt", description: "A button-up denim shirt for formal occasions.", rating: 4.3, price: "$95", discount: 0.2, availableSizes: ["small", "medium", "large", "xlarge"], categories: ["formal"], arrivalDate: "2023-12-01", stock: 85 },
    { _id: 38, imgPath: "./assets/Products/p38.png", name: "Fitted Blazer", description: "A fitted blazer for a sharp and formal look.", rating: 4.7, price: "$220", discount: 0.15, availableSizes: ["medium", "large", "xlarge", "xxlarge"], categories: ["formal"], arrivalDate: "2024-01-01", stock: 35 },
    { _id: 39, imgPath: "./assets/Products/p39.png", name: "Cotton Hoodie", description: "A comfortable cotton hoodie for casual wear.", rating: 4, price: "$90", discount: 0.0, availableSizes: ["medium", "large", "xxlarge"], categories: ["casual"], arrivalDate: "2022-05-01", stock: 60 },
    { _id: 40, imgPath: "./assets/Products/p40.png", name: "Striped Crop Top", description: "A striped crop top for casual and party occasions.", rating: 3.9, price: "$45", discount: 0.25, availableSizes: ["xxsmall", "xsmall", "small"], categories: ["casual", "party"], arrivalDate: "2024-03-01", stock: 12 },
    { _id: 41, imgPath: "./assets/Products/p41.png", name: "Denim Jacket", description: "A classic denim jacket for casual and formal wear.", rating: 4.8, price: "$160", discount: 0.0, availableSizes: ["small", "medium", "large", "xxlarge"], categories: ["casual", "formal"], arrivalDate: "2022-06-01", stock: 45 },
    { _id: 42, imgPath: "./assets/Products/p42.png", name: "Faux Leather Skirt", description: "A faux leather skirt for casual and party occasions.", rating: 4.2, price: "$70", discount: 0.12, availableSizes: ["xsmall", "small", "medium"], categories: ["casual", "party"], arrivalDate: "2024-05-01", stock: 55 }
];

export const ordersList = [
    {
        _id: "681547e896864a9a815d5b4c",
        user: "68120de0f2ba712c20a76154",
        orderItems: [
            {
                product: "68121198f1aefe8008bbdce7",
                quantity: 4,
                price: 12.99,
                name: "The Great Gatsby",
                _id: "681547e896864a9a815d5b4d"
            }
        ],
        shippingAddress: {
            address: "123 Test Street",
            city: "Test City",
            postalCode: "1235",
            country: "USA",
            phone: "12357890",
            _id: "681547e896864a9a815d5b4e"
        },
        paymentMethod: "credit_card",
        itemsPrice: 51.96,
        shippingPrice: 10,
        taxPrice: 4.6764,
        totalPrice: 61.4404,
        isPaid: true,
        isDelivered: true,
        status: "refunded",
        createdAt: "2025-05-02T22:32:08.915Z",
        updatedAt: "2025-05-02T22:36:04.191Z",
        paidAt: "2025-05-02T22:34:29.315Z",
        deliveredAt: "2025-05-02T22:35:22.874Z",
        refundNotes: "The product packaging was crushed and the item inside is broken.",
        refundReason: "Item arrived damaged",
        adminRefundNotes: "Approved based on customer photos",
        refundedAt: "2025-05-02T22:36:04.191Z",
        paymentResult: {
            id: "1746225269315",
            status: "COMPLETED",
            update_time: "2025-05-02T22:34:29.315Z",
            email_address: "admin@example.com"
        }
    },
    {
        _id: "681547e896864a9a815d5b4f",
        user: "68120de0f2ba712c20a76155",
        orderItems: [
            {
                product: "68121198f1aefe8008bbdce8",
                quantity: 2,
                price: 25.99,
                name: "1984",
                _id: "681547e896864a9a815d5b50"
            }
        ],
        shippingAddress: {
            address: "456 Another Street",
            city: "Another City",
            postalCode: "5678",
            country: "USA",
            phone: "98765432",
            _id: "681547e896864a9a815d5b51"
        },
        paymentMethod: "paypal",
        itemsPrice: 51.98,
        shippingPrice: 5,
        taxPrice: 3.119,
        totalPrice: 60.099,
        isPaid: true,
        isDelivered: false,
        status: "processing",
        createdAt: "2025-05-03T10:00:00.000Z",
        updatedAt: "2025-05-03T10:30:00.000Z",
        paidAt: "2025-05-03T10:15:00.000Z",
        paymentResult: {
            id: "1746225269316",
            status: "COMPLETED",
            update_time: "2025-05-03T10:15:00.000Z",
            email_address: "user1@example.com"
        }
    },
    {
        _id: "681547e896864a9a815d5b52",
        user: "68120de0f2ba712c20a76156",
        orderItems: [
            {
                product: "68121198f1aefe8008bbdce9",
                quantity: 1,
                price: 15.99,
                name: "To Kill a Mockingbird",
                _id: "681547e896864a9a815d5b53"
            }
        ],
        shippingAddress: {
            address: "789 Example Road",
            city: "Example City",
            postalCode: "9101",
            country: "USA",
            phone: "12345678",
            _id: "681547e896864a9a815d5b54"
        },
        paymentMethod: "credit_card",
        itemsPrice: 15.99,
        shippingPrice: 7,
        taxPrice: 1.2792,
        totalPrice: 24.2692,
        isPaid: true,
        isDelivered: true,
        status: "completed",
        createdAt: "2025-05-04T12:00:00.000Z",
        updatedAt: "2025-05-04T12:45:00.000Z",
        paidAt: "2025-05-04T12:15:00.000Z",
        deliveredAt: "2025-05-04T12:30:00.000Z",
        paymentResult: {
            id: "1746225269317",
            status: "COMPLETED",
            update_time: "2025-05-04T12:15:00.000Z",
            email_address: "user2@example.com"
        }
    },
    {
        _id: "681547e896864a9a815d5b55",
        user: "68120de0f2ba712c20a76157",
        orderItems: [
            {
                product: "68121198f1aefe8008bbdcea",
                quantity: 3,
                price: 10.99,
                name: "The Catcher in the Rye",
                _id: "681547e896864a9a815d5b56"
            }
        ],
        shippingAddress: {
            address: "101 Fiction Lane",
            city: "Fiction City",
            postalCode: "1122",
            country: "USA",
            phone: "87654321",
            _id: "681547e896864a9a815d5b57"
        },
        paymentMethod: "credit_card",
        itemsPrice: 32.97,
        shippingPrice: 8,
        taxPrice: 2.6376,
        totalPrice: 43.6076,
        isPaid: false,
        isDelivered: false,
        status: "pending",
        createdAt: "2025-05-05T14:00:00.000Z",
        updatedAt: "2025-05-05T14:30:00.000Z"
    },
    {
        _id: "681547e896864a9a815d5b58",
        user: "68120de0f2ba712c20a76158",
        orderItems: [
            {
                product: "68121198f1aefe8008bbdceb",
                quantity: 5,
                price: 8.99,
                name: "Animal Farm",
                _id: "681547e896864a9a815d5b59"
            }
        ],
        shippingAddress: {
            address: "202 Novel Street",
            city: "Novel City",
            postalCode: "3344",
            country: "USA",
            phone: "56789012",
            _id: "681547e896864a9a815d5b5a"
        },
        paymentMethod: "paypal",
        itemsPrice: 44.95,
        shippingPrice: 6,
        taxPrice: 3.596,
        totalPrice: 54.546,
        isPaid: true,
        isDelivered: true,
        status: "completed",
        createdAt: "2025-05-06T16:00:00.000Z",
        updatedAt: "2025-05-06T16:45:00.000Z",
        paidAt: "2025-05-06T16:15:00.000Z",
        deliveredAt: "2025-05-06T16:30:00.000Z",
        paymentResult: {
            id: "1746225269318",
            status: "COMPLETED",
            update_time: "2025-05-06T16:15:00.000Z",
            email_address: "user3@example.com"
        }
    },
    {
        _id: "681547e896864a9a815d5b5b",
        user: "68120de0f2ba712c20a76159",
        orderItems: [
            {
                product: "68121198f1aefe8008bbdcec",
                quantity: 1,
                price: 20.99,
                name: "Brave New World",
                _id: "681547e896864a9a815d5b5c"
            }
        ],
        shippingAddress: {
            address: "303 Dystopia Avenue",
            city: "Dystopia City",
            postalCode: "5566",
            country: "USA",
            phone: "34567890",
            _id: "681547e896864a9a815d5b5d"
        },
        paymentMethod: "credit_card",
        itemsPrice: 20.99,
        shippingPrice: 4,
        taxPrice: 1.6792,
        totalPrice: 26.6692,
        isPaid: true,
        isDelivered: false,
        status: "processing",
        createdAt: "2025-05-07T18:00:00.000Z",
        updatedAt: "2025-05-07T18:30:00.000Z",
        paidAt: "2025-05-07T18:15:00.000Z",
        paymentResult: {
            id: "1746225269319",
            status: "COMPLETED",
            update_time: "2025-05-07T18:15:00.000Z",
            email_address: "user4@example.com"
        }
    }
];

let host = "http://localhost:3000";
export const envToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4MWQxYmJkYzk2Y2ExYjZkNzVhOWM4OCIsImVtYWlsIjoiYWRtaW5Ac3lzdGVtLmNvbSIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTc0NjczODE2MiwiZXhwIjoxNzQ2ODI0NTYyfQ.Q3PDQYrWwrL2fH5t6ckj70cNnkYsPhlJcZ79oSA18fA";


export async function fetchProducts() {
    try {
        let query = {
            limit: 0
        }
        const res = await makeRequest(`${host}/api/products`, 'GET', null, envToken, query);
        console.log(res);
        return res.products.reverse();
    } catch (err) {
        console.error('Error fetching products', err);
    }
}

export async function fetchOrders() {
    return ordersList;
}

export async function fetchProductById(id) {
    try {
        const res = await makeRequest(`${host}/api/products/${id}`, 'GET', null, null);
        console.log(res);
        return res;
    }catch (err) {
        console.error('Error fetching product', err);
    }
}

export function filterProducts(productsList, filters) {
    let filteredProducts = productsList.filter((product) => {
        
        const price = parseInt(product.price);
        if(filters.minPrice > price || filters.maxPrice < price) {
            return false;
        }

        // Filter by sizes
        let sizeMatch = true;
        let hasSizeFilter = false;

        for (let size in filters.sizes) {
            if (filters.sizes[size]) {
                hasSizeFilter = true;
                if (!product.availableSizes.includes(size)) {
                    sizeMatch = false;
                    break;
                }
            }
        }

        if (hasSizeFilter && !sizeMatch) {
            return false;
        }

        // Filter by styles/categories
        let styleMatch = true;
        let hasStyleFilter = false;

        for (let style in filters.styles) {
            if (filters.styles[style]) {
                hasStyleFilter = true;
                if (!product.categories.includes(style)) {
                    styleMatch = false;
                    break;
                }
            }
        }

        if (hasStyleFilter && !styleMatch) {
            return false;
        }

        // Filter by rating
        if (filters.rating > product.rating) {
            return false;
        }

        return true;
    });

    return filteredProducts;
}

export async function specialSearchProducts(productsList, searchTerm) {
    try {
        if (searchTerm.toLowerCase() === "new") {
            // Fetch newest products (sort by creation date)
            const response = await fetch(`${API_BASE_URL}/products?sort=createdAt:desc&limit=10`);
            if (!response.ok) throw new Error('Failed to fetch new products');
            const data = await response.json();
            return data.products || [];
        }

        if (searchTerm.toLowerCase() === "sale") {
            // Fetch products with discount
            const response = await fetch(`${API_BASE_URL}/products?discount=true`);
            if (!response.ok) throw new Error('Failed to fetch sale products');
            const data = await response.json();
            return data.products || [];
        }

        if (searchTerm.toLowerCase() === "all") {
            // Fetch all products
            const response = await fetch(`${API_BASE_URL}/products`);
            if (!response.ok) throw new Error('Failed to fetch all products');
            const data = await response.json();
            return data.products || [];
        }

        return productsList;
    } catch (error) {
        console.error('Error in specialSearchProducts:', error);
        return productsList;
    }
}

export async function keyFilterProducts(productsList, keyFilter) {
    try {
        const [key, value] = keyFilter.split("-");

        if (key === "categories") {
            // Filter by category
            const response = await fetch(`${API_BASE_URL}/products?category=${value}`);
            if (!response.ok) throw new Error('Failed to fetch products by category');
            const data = await response.json();
            return data.products || [];
        }

        // For other keys, filter locally
        return productsList.filter((product) => {
            return product[key] &&
                (Array.isArray(product[key]) ?
                    product[key].includes(value) :
                    product[key] === value);
        });
    } catch (error) {
        console.error('Error in keyFilterProducts:', error);
        return productsList;
    }
}

export function keyFilterProducts(productsList, keyFilter){
    let [key, value] = keyFilter.split("-");
    return productsList.filter((product) => {
        return product[key].includes(value);
    })
}

export function searchProducts(productsList, searchTerm) {
    return productsList.filter((product) => {
        return product.name.toLowerCase().includes(searchTerm.toLowerCase());
    });
}

export async function makeRequest(endpoint, method = 'GET', body = null, token = null, params = null) {
  try {
    const headers = {
      'Content-Type': 'application/json',
    };

    if (token) {
      headers['Authorization'] = `Bearer ${token}`;
    }

    // Append query params for GET requests
    if (params && method === 'GET') {
      const query = new URLSearchParams(params).toString();
      endpoint += `?${query}`;
    }

    const options = {
      method,
      headers,
    };

    if (body && method !== 'GET') {
      options.body = JSON.stringify(body);
    }

    const response = await fetch(endpoint, options);

    if (!response.ok) {
      throw new Error(`Error: ${response.status} - ${response.statusText}`);
    }

    const data = await response.json();
    return data;

  } catch (error) {
    console.error("Request failed:", error);
    throw error;
  }
}

export async function addAllProducts(){
    productsList.forEach(async (product) => {
        await createProduct(product, envToken);
    })
    let products = await fetchProducts();
    for (let i = 0; i < products.length; i++) {
        let product = products[i];
        let rating = Math.floor(Math.random() * 5) + 1;
        await addProductReview(product, {rating: rating, comment: "This is a great product"}, envToken);
    }
}

export async function getAllOrders(token) {
    return await makeRequest(`${host}/api/orders`, 'GET', null, token);
}

export function addProductReview(product, review, token){
    if (!token) {
        throw new Error("Authentication token is required");
    }

    let body = {
        rating: review.rating > 1 ? review.rating : 1,
        comment: review.comment
    }

    const endpoint = `${host}/api/products/${product.id}/reviews`;
    return makeRequest(endpoint, 'POST', body, token);
}

export async function createProduct(product, token) {
    if (!token) {
        throw new Error("Authentication token is required");
    }

    let body = {
        name: product.name,
        description: product.description,
        price: parseInt(product.price.slice(1)),
        categories: product.categories,
        availableSizes: product.availableSizes,
        brand: 'SHOP.CO',
        countInStock: product.stock,
        imagePath: product.imgPath,
        isFeatured: true,
        discount: product.discount * 100
    }

    const endpoint = `${host}/api/products`;
    return await makeRequest(endpoint, 'POST', body, token);
}

export async function addToCart(cartItem, token) {
    const endpoint = `${host}/api/cart`;
    return await makeRequest(endpoint, 'POST', cartItem, token);
    
}

export function getCookie(name) {
    const cookies = document.cookie.split(';');
    for (let cookie of cookies) {
        const [cookieName, cookieValue] = cookie.trim().split('=');
        if (cookieName === name) {
            return decodeURIComponent(cookieValue);
        }
    }
    return null;
}